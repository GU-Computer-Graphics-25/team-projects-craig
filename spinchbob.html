<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spongebob Detailed++ (Classic Scripts)</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="./js/three.js"></script>
    <script src="./js/OrbitControls.js"></script>
    <script src="./js/SceneUtils.js"></script> <script>
        // No more 'import' statements needed here

        // === Scene Setup ===
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);

        // === Camera Setup ===
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2.5, 7);

        // === Renderer Setup ===
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // === Lighting ===
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);

        // === SpongeBob Group ===
        const spongebobGroup = new THREE.Group();
        scene.add(spongebobGroup);

        // --- Constants for Dimensions ---
        const bodyWidth = 2;
        const bodyHeight = 2.2;
        const bodyDepth = 1;
        const pantsHeight = 0.6;
        const shirtHeight = 0.3;
        const legRadius = 0.15;
        const legHeight = 0.8;
        const armRadius = 0.12;
        const armLength = 1.0;
        const shoeLength = 0.4;
        const shoeWidth = 0.25;
        const shoeHeight = 0.2;

        // --- Materials ---
        const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFF00 });
        const pantsMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
        const shirtMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFFFF });
        const legArmMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFF00 });
        const spotMaterial = new THREE.MeshStandardMaterial({ color: 0xDAA520, side: THREE.DoubleSide });
        const beltMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
        const eyeballMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFFFF });
        const irisMaterial = new THREE.MeshStandardMaterial({ color: 0x4682B4 });
        const pupilMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
        const shoeMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 });
        const spatulaHandleMaterial = new THREE.MeshStandardMaterial({ color: 0x333333 });
        const spatulaBladeMaterial = new THREE.MeshStandardMaterial({ color: 0xCCCCCC });

        // --- SpongeBob Body ---
        const bodyGeometry = new THREE.BoxGeometry(bodyWidth, bodyHeight, bodyDepth);
        const bodyMesh = new THREE.Mesh(bodyGeometry, bodyMaterial);
        bodyMesh.position.y = bodyHeight / 2;
        spongebobGroup.add(bodyMesh);

        // --- Pants ---
        const pantsGeometry = new THREE.BoxGeometry(bodyWidth * 1.05, pantsHeight, bodyDepth * 1.05);
        const pantsMesh = new THREE.Mesh(pantsGeometry, pantsMaterial);
        const pantsTopY = -pantsHeight / 2;
        pantsMesh.position.y = pantsTopY;
        spongebobGroup.add(pantsMesh);

        // --- Shirt ---
        const shirtGeometry = new THREE.BoxGeometry(bodyWidth * 1.02, shirtHeight, bodyDepth * 1.02);
        const shirtMesh = new THREE.Mesh(shirtGeometry, shirtMaterial);
        shirtMesh.position.y = pantsTopY + pantsHeight / 2 + shirtHeight / 2;
        spongebobGroup.add(shirtMesh);

        // --- Belt ---
        const beltHeight = 0.08;
        const beltGeometry = new THREE.BoxGeometry(bodyWidth * 1.07, beltHeight, bodyDepth * 1.07);
        const beltMesh = new THREE.Mesh(beltGeometry, beltMaterial);
        beltMesh.position.y = pantsTopY + pantsHeight / 2 + beltHeight / 2;
        beltMesh.position.z = 0.01;
        spongebobGroup.add(beltMesh);

        // --- Legs ---
        const legGeometry = new THREE.CylinderGeometry(legRadius, legRadius, legHeight, 8);
        const legBottomY = pantsMesh.position.y - pantsHeight / 2 - legHeight;

        const leftLegMesh = new THREE.Mesh(legGeometry, legArmMaterial);
        leftLegMesh.position.set(-bodyWidth / 4, pantsMesh.position.y - pantsHeight / 2 - legHeight / 2, 0);
        spongebobGroup.add(leftLegMesh);

        const rightLegMesh = new THREE.Mesh(legGeometry, legArmMaterial);
        rightLegMesh.position.set(bodyWidth / 4, pantsMesh.position.y - pantsHeight / 2 - legHeight / 2, 0);
        spongebobGroup.add(rightLegMesh);

        // --- Shoes ---
        const shoeGeometry = new THREE.BoxGeometry(shoeWidth, shoeHeight, shoeLength);

        const leftShoeMesh = new THREE.Mesh(shoeGeometry, shoeMaterial);
        leftShoeMesh.position.set(leftLegMesh.position.x, legBottomY - shoeHeight / 2, shoeLength / 4);
        spongebobGroup.add(leftShoeMesh);

        const rightShoeMesh = new THREE.Mesh(shoeGeometry, shoeMaterial);
        rightShoeMesh.position.set(rightLegMesh.position.x, legBottomY - shoeHeight / 2, shoeLength / 4);
        spongebobGroup.add(rightShoeMesh);

        // --- Arms ---
        const armGeometry = new THREE.CylinderGeometry(armRadius, armRadius, armLength, 8);

        const leftArmMesh = new THREE.Mesh(armGeometry, legArmMaterial);
        leftArmMesh.position.set(-bodyWidth / 2 - armLength / 2 + 0.3, bodyMesh.position.y - 0.5, 0);
        leftArmMesh.rotation.z = Math.PI / 2.8;
        spongebobGroup.add(leftArmMesh);

        const rightArmMesh = new THREE.Mesh(armGeometry, legArmMaterial);
        rightArmMesh.position.set(bodyWidth / 2 + armLength / 2 - 0.4, bodyMesh.position.y - 0.6, 0.1);
        rightArmMesh.rotation.z = -Math.PI / 2.2;
        rightArmMesh.rotation.x = -Math.PI / 16;
        spongebobGroup.add(rightArmMesh);

        // --- Eyes ---
        const eyeRadius = 0.3;
        const irisRadius = 0.15;
        const pupilRadius = 0.07;
        const eyeSeparation = 0.45;
        const eyeHeight = bodyMesh.position.y + 0.5;
        const eyeForwardOffset = bodyDepth / 2;

        function createEye() {
            const eyeGroup = new THREE.Group();
            const eyeballGeo = new THREE.SphereGeometry(eyeRadius, 16, 16);
            const eyeballMesh = new THREE.Mesh(eyeballGeo, eyeballMaterial);
            eyeGroup.add(eyeballMesh);

            const irisGeo = new THREE.SphereGeometry(irisRadius, 12, 12);
            const irisMesh = new THREE.Mesh(irisGeo, irisMaterial);
            irisMesh.position.z = eyeRadius - 0.01;
            eyeGroup.add(irisMesh);

            const pupilGeo = new THREE.SphereGeometry(pupilRadius, 8, 8);
            const pupilMesh = new THREE.Mesh(pupilGeo, pupilMaterial);
            pupilMesh.position.z = eyeRadius + irisRadius * 0.3;
            eyeGroup.add(pupilMesh);

            return eyeGroup;
        }

        const leftEye = createEye();
        leftEye.position.set(-eyeSeparation, eyeHeight, eyeForwardOffset);
        spongebobGroup.add(leftEye);

        const rightEye = createEye();
        rightEye.position.set(eyeSeparation, eyeHeight, eyeForwardOffset);
        spongebobGroup.add(rightEye);

        // --- Spots ---
        const spotRadius = 0.15;
        const spotGeometry = new THREE.CircleGeometry(spotRadius, 8);
        const spotsData = [
            { x: -0.5, y: 1.8, z: bodyDepth / 2 + 0.01 },
            { x: 0.6, y: 1.5, z: bodyDepth / 2 + 0.01 },
            { x: 0.0, y: 1.0, z: bodyDepth / 2 + 0.01 },
            { x: -0.7, y: 0.5, z: bodyDepth / 2 + 0.01 },
            { x: 0.4, y: 0.2, z: bodyDepth / 2 + 0.01 },
            { x: -0.4, y: 1.6, z: -bodyDepth / 2 - 0.01, ry: Math.PI },
            { x: 0.5, y: 0.8, z: -bodyDepth / 2 - 0.01, ry: Math.PI },
        ];

        spotsData.forEach(data => {
            const spotMesh = new THREE.Mesh(spotGeometry, spotMaterial);
            spotMesh.position.set(data.x, data.y, data.z);
            if (data.ry) {
                spotMesh.rotation.y = data.ry;
            }
            spongebobGroup.add(spotMesh);
        });

        // --- Spatula ---
        const spatulaGroup = new THREE.Group();
        const handleLength = 0.8;
        const handleRadius = 0.05;
        const bladeWidth = 0.3;
        const bladeHeight = 0.02;
        const bladeLength = 0.4;

        const handleGeo = new THREE.CylinderGeometry(handleRadius, handleRadius, handleLength, 8);
        const handleMesh = new THREE.Mesh(handleGeo, spatulaHandleMaterial);
        handleMesh.position.y = -handleLength / 2;
        spatulaGroup.add(handleMesh);

        const bladeGeo = new THREE.BoxGeometry(bladeWidth, bladeHeight, bladeLength);
        const bladeMesh = new THREE.Mesh(bladeGeo, spatulaBladeMaterial);
        bladeMesh.position.y = 0;
        bladeMesh.position.z = bladeLength / 2;
        spatulaGroup.add(bladeMesh);

        const armRotationZ = rightArmMesh.rotation.z;
        const handX = rightArmMesh.position.x + Math.cos(armRotationZ) * (armLength / 1.9);
        const handY = rightArmMesh.position.y + Math.sin(armRotationZ) * (armLength / 1.9);
        const handZ = rightArmMesh.position.z;

        spatulaGroup.position.set(handX, handY, handZ);
        spatulaGroup.rotation.z = Math.PI / 2 + armRotationZ;
        spatulaGroup.rotation.y = -Math.PI / 16;

        spongebobGroup.add(spatulaGroup);

        // === Final Group Positioning ===
        const lowestPoint = legBottomY - shoeHeight;
        spongebobGroup.position.y = -lowestPoint;

        // === Controls ===
        // Reference OrbitControls via the global THREE object
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        const targetY = bodyMesh.position.y + spongebobGroup.position.y;
        controls.target.set(spongebobGroup.position.x, targetY, spongebobGroup.position.z);
        controls.update();

        // === Animation Loop ===
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>

</body>
</html>