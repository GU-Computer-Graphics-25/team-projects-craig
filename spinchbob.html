<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spongebob Detailed++</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script type="importmap">
        "imports": {
            "three": "https://unpkg.com/three@0.163.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.163.0/examples/jsm/"
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // === Scene Setup ===
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);

        // === Camera Setup ===
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2.5, 7); // Adjusted for better view

        // === Renderer Setup ===
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // === Lighting ===
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);

        // === SpongeBob Group ===
        const spongebobGroup = new THREE.Group();
        scene.add(spongebobGroup);

        // --- Constants for Dimensions ---
        const bodyWidth = 2;
        const bodyHeight = 2.2;
        const bodyDepth = 1;
        const pantsHeight = 0.6;
        const shirtHeight = 0.3;
        const legRadius = 0.15;
        const legHeight = 0.8;
        const armRadius = 0.12;
        const armLength = 1.0;
        const shoeLength = 0.4;
        const shoeWidth = 0.25;
        const shoeHeight = 0.2;

        // --- Materials ---
        const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFF00 }); // Yellow
        const pantsMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 }); // Brown
        const shirtMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFFFF }); // White
        const legArmMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFF00 }); // Yellow
        const spotMaterial = new THREE.MeshStandardMaterial({ color: 0xDAA520, side: THREE.DoubleSide }); // Dark Yellow
        const beltMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 }); // Black
        const eyeballMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFFFF }); // White
        const irisMaterial = new THREE.MeshStandardMaterial({ color: 0x4682B4 }); // Steel Blue
        const pupilMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 }); // Black
        const shoeMaterial = new THREE.MeshStandardMaterial({ color: 0x000000 }); // Black
        const spatulaHandleMaterial = new THREE.MeshStandardMaterial({ color: 0x333333 }); // Dark Grey
        const spatulaBladeMaterial = new THREE.MeshStandardMaterial({ color: 0xCCCCCC }); // Light Grey/Silver

        // --- SpongeBob Body ---
        const bodyGeometry = new THREE.BoxGeometry(bodyWidth, bodyHeight, bodyDepth);
        const bodyMesh = new THREE.Mesh(bodyGeometry, bodyMaterial);
        bodyMesh.position.y = bodyHeight / 2;
        spongebobGroup.add(bodyMesh);

        // --- Pants ---
        const pantsGeometry = new THREE.BoxGeometry(bodyWidth * 1.05, pantsHeight, bodyDepth * 1.05);
        const pantsMesh = new THREE.Mesh(pantsGeometry, pantsMaterial);
        const pantsTopY = -pantsHeight / 2; // Remember Y position of the top of the pants
        pantsMesh.position.y = pantsTopY;
        spongebobGroup.add(pantsMesh);

        // --- Shirt ---
        const shirtGeometry = new THREE.BoxGeometry(bodyWidth * 1.02, shirtHeight, bodyDepth * 1.02);
        const shirtMesh = new THREE.Mesh(shirtGeometry, shirtMaterial);
        shirtMesh.position.y = pantsTopY + pantsHeight / 2 + shirtHeight / 2;
        spongebobGroup.add(shirtMesh);

        // --- Belt ---
        const beltHeight = 0.08;
        const beltGeometry = new THREE.BoxGeometry(bodyWidth * 1.07, beltHeight, bodyDepth * 1.07); // Slightly bigger than pants
        const beltMesh = new THREE.Mesh(beltGeometry, beltMaterial);
        // Position it exactly at the top of the pants (which is the bottom of the shirt)
        beltMesh.position.y = pantsTopY + pantsHeight / 2 + beltHeight / 2;
        beltMesh.position.z = 0.01; // Slightly forward to avoid z-fighting with shirt/pants
        spongebobGroup.add(beltMesh);

        // --- Legs ---
        const legGeometry = new THREE.CylinderGeometry(legRadius, legRadius, legHeight, 8);
        const legBottomY = pantsMesh.position.y - pantsHeight / 2 - legHeight; // Y where leg ends

        const leftLegMesh = new THREE.Mesh(legGeometry, legArmMaterial);
        leftLegMesh.position.set(-bodyWidth / 4, pantsMesh.position.y - pantsHeight / 2 - legHeight / 2, 0);
        spongebobGroup.add(leftLegMesh);

        const rightLegMesh = new THREE.Mesh(legGeometry, legArmMaterial);
        rightLegMesh.position.set(bodyWidth / 4, pantsMesh.position.y - pantsHeight / 2 - legHeight / 2, 0);
        spongebobGroup.add(rightLegMesh);

        // --- Shoes ---
        const shoeGeometry = new THREE.BoxGeometry(shoeWidth, shoeHeight, shoeLength); // Note Z is length here

        const leftShoeMesh = new THREE.Mesh(shoeGeometry, shoeMaterial);
        leftShoeMesh.position.set(leftLegMesh.position.x, legBottomY - shoeHeight / 2, shoeLength / 4); // Position slightly forward
        spongebobGroup.add(leftShoeMesh);

        const rightShoeMesh = new THREE.Mesh(shoeGeometry, shoeMaterial);
        rightShoeMesh.position.set(rightLegMesh.position.x, legBottomY - shoeHeight / 2, shoeLength / 4); // Position slightly forward
        spongebobGroup.add(rightShoeMesh);

        // --- Arms ---
        const armGeometry = new THREE.CylinderGeometry(armRadius, armRadius, armLength, 8);

        const leftArmMesh = new THREE.Mesh(armGeometry, legArmMaterial);
        leftArmMesh.position.set(-bodyWidth / 2 - armLength / 2 + 0.3, bodyMesh.position.y - 0.5, 0);
        leftArmMesh.rotation.z = Math.PI / 2.8;
        spongebobGroup.add(leftArmMesh);

        const rightArmMesh = new THREE.Mesh(armGeometry, legArmMaterial);
        // Adjust right arm position slightly to hold spatula better
        rightArmMesh.position.set(bodyWidth / 2 + armLength / 2 - 0.4, bodyMesh.position.y - 0.6, 0.1);
        rightArmMesh.rotation.z = -Math.PI / 2.2; // More bent to hold spatula
        rightArmMesh.rotation.x = -Math.PI / 16; // Slight forward rotation
        spongebobGroup.add(rightArmMesh);

        // --- Eyes ---
        const eyeRadius = 0.3;
        const irisRadius = 0.15;
        const pupilRadius = 0.07;
        const eyeSeparation = 0.45; // Distance from center to eye center
        const eyeHeight = bodyMesh.position.y + 0.5; // Y position on the body
        const eyeForwardOffset = bodyDepth / 2;

        function createEye() {
            const eyeGroup = new THREE.Group();
            const eyeballGeo = new THREE.SphereGeometry(eyeRadius, 16, 16);
            const eyeballMesh = new THREE.Mesh(eyeballGeo, eyeballMaterial);
            eyeGroup.add(eyeballMesh);

            const irisGeo = new THREE.SphereGeometry(irisRadius, 12, 12);
            const irisMesh = new THREE.Mesh(irisGeo, irisMaterial);
            irisMesh.position.z = eyeRadius - 0.01; // Slightly in front of eyeball surface
            eyeGroup.add(irisMesh);

            const pupilGeo = new THREE.SphereGeometry(pupilRadius, 8, 8);
            const pupilMesh = new THREE.Mesh(pupilGeo, pupilMaterial);
            pupilMesh.position.z = eyeRadius + irisRadius * 0.3; // Slightly in front of iris surface
            eyeGroup.add(pupilMesh);

            return eyeGroup;
        }

        const leftEye = createEye();
        leftEye.position.set(-eyeSeparation, eyeHeight, eyeForwardOffset);
        spongebobGroup.add(leftEye);

        const rightEye = createEye();
        rightEye.position.set(eyeSeparation, eyeHeight, eyeForwardOffset);
        spongebobGroup.add(rightEye);


        // --- Spots ---
        const spotRadius = 0.15;
        const spotGeometry = new THREE.CircleGeometry(spotRadius, 8);
        const spotsData = [
            { x: -0.5, y: 1.8, z: bodyDepth / 2 + 0.01 },
            { x: 0.6, y: 1.5, z: bodyDepth / 2 + 0.01 },
            { x: 0.0, y: 1.0, z: bodyDepth / 2 + 0.01 },
            { x: -0.7, y: 0.5, z: bodyDepth / 2 + 0.01 },
            { x: 0.4, y: 0.2, z: bodyDepth / 2 + 0.01 },
            { x: -0.4, y: 1.6, z: -bodyDepth / 2 - 0.01, ry: Math.PI },
            { x: 0.5, y: 0.8, z: -bodyDepth / 2 - 0.01, ry: Math.PI },
        ];

        spotsData.forEach(data => {
            const spotMesh = new THREE.Mesh(spotGeometry, spotMaterial);
            spotMesh.position.set(data.x, data.y, data.z);
            if (data.ry) {
                spotMesh.rotation.y = data.ry;
            }
            spongebobGroup.add(spotMesh);
        });

        // --- Spatula ---
        const spatulaGroup = new THREE.Group();
        const handleLength = 0.8;
        const handleRadius = 0.05;
        const bladeWidth = 0.3;
        const bladeHeight = 0.02;
        const bladeLength = 0.4;

        const handleGeo = new THREE.CylinderGeometry(handleRadius, handleRadius, handleLength, 8);
        const handleMesh = new THREE.Mesh(handleGeo, spatulaHandleMaterial);
        handleMesh.position.y = -handleLength / 2; // Center handle origin at its top
        spatulaGroup.add(handleMesh);

        const bladeGeo = new THREE.BoxGeometry(bladeWidth, bladeHeight, bladeLength);
        const bladeMesh = new THREE.Mesh(bladeGeo, spatulaBladeMaterial);
        bladeMesh.position.y = 0; // Position blade relative to handle top
        bladeMesh.position.z = bladeLength / 2; // Extend blade forward from handle center
        spatulaGroup.add(bladeMesh);

        // Position spatula near the right hand
        // Find approx hand position: arm attachment + vector along rotated arm
        const armRotationZ = rightArmMesh.rotation.z;
        const handX = rightArmMesh.position.x + Math.cos(armRotationZ) * (armLength / 1.9);
        const handY = rightArmMesh.position.y + Math.sin(armRotationZ) * (armLength / 1.9);
        const handZ = rightArmMesh.position.z;

        spatulaGroup.position.set(handX, handY, handZ);
        spatulaGroup.rotation.z = Math.PI / 2 + armRotationZ; // Align with arm
        spatulaGroup.rotation.y = -Math.PI / 16; // Slight angle

        spongebobGroup.add(spatulaGroup);


        // === Final Group Positioning ===
        // Lift the whole group so the bottom of the shoes are near y=0
        const lowestPoint = legBottomY - shoeHeight; // Y-coordinate of the bottom of the shoes
        spongebobGroup.position.y = -lowestPoint; // Adjust group position

        // === Controls ===
        const controls = new OrbitControls(camera, renderer.domElement);
        // Target the center of Spongebob's body for better rotation focus
        const targetY = bodyMesh.position.y + spongebobGroup.position.y;
        controls.target.set(spongebobGroup.position.x, targetY, spongebobGroup.position.z);
        controls.update();

        // === Handle Window Resize ===
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        window.addEventListener('resize', onWindowResize);

        // === Animation Loop ===
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>